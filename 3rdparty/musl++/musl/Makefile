all: checkout configure build

##==============================================================================
##
## checkout:
##
##==============================================================================

MUSL=musl-1.1.21

checkout: musl

musl:
	rm -rf ${MUSL}*
	wget http://www.musl-libc.org/releases/${MUSL}.tar.gz
	tar zxvf ${MUSL}.tar.gz
	mv ${MUSL} musl
	rm -rf ${MUSL}*

##==============================================================================
##
## distclean:
##
##==============================================================================

distclean:
	rm -rf musl

##==============================================================================
##
## configure:
##
##==============================================================================

configure: musl
	(cd musl; ./configure CFLAGS=-fPIC --prefix=/opt/musl++ --disable-shared)

##==============================================================================
##
## build:
##
##==============================================================================

build:
	$(MAKE) -C musl

##==============================================================================
##
## clean:
##
##==============================================================================

clean:
	$(MAKE) -C musl clean

##==============================================================================
##
## install:
##
##==============================================================================

install:
	( cd musl; $(MAKE) install )
	( cp musl-g++ /opt/musl++/bin )
	( mkdir -p /opt/musl++/include/linux )
	( cp /usr/include/linux/version.h /opt/musl++/include/linux )
